<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <meta name="description" content="Private Meet - Secure and Private Video, Audio, Chat Conferencing">
    <link rel="shortcut icon" href="favicon.svg" type="image/x-icon">
    <link rel="stylesheet" href="/styles.css">
    <script src="/socket.io/socket.io.js"></script>
</head>

<body class="h-screen flex flex-col bg-gray-900 text-white">
    <!-- Overlay de loading -->
    <div id="client-loading" class="fixed inset-0 flex items-center justify-center bg-black/50 z-50">
        <div class="flex flex-col items-center gap-4">
            <div class="h-12 w-12 rounded-full border-4 border-indigo-500 border-t-transparent animate-spin"></div>
            <p class="text-white text-sm font-medium">Connecting...</p>
        </div>
    </div>

    <!-- Top Bar -->
    <header
        class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-800 via-gray-900 to-gray-800 border-b border-gray-600/50 backdrop-blur-sm shadow-lg">
        <!-- Menu icon (mobile only) -->
        <div class="flex items-center lg:hidden">
            <img src="/icons/menu.svg" alt="Menu" id="menu-icon"
                class="w-6 h-6 cursor-pointer hover:scale-110 transition-all duration-200 hover:rotate-180 filter hover:brightness-125" />
        </div>

        <!-- Logo/Title - Central -->
        <div class="flex items-center gap-2 lg:gap-3">
            <div
                class="w-7 h-7 lg:w-8 lg:h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg">
                <svg class="w-4 h-4 lg:w-5 lg:h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path
                        d="M2 6a2 2 0 012-2h6a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z" />
                </svg>
            </div>
            <h1
                class="text-lg lg:text-xl font-bold bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent">
                <a href="/" class="hover:from-indigo-300 hover:to-purple-300 transition-all duration-300">Private
                    Meet</a>
            </h1>
        </div>

        <!-- Copy Room ID Button -->
        <div class="flex items-center">
            <button id="copy-room-id"
                class="group px-2 py-1 lg:px-4 lg:py-2 bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-500 hover:to-indigo-600 rounded-lg text-xs lg:text-sm font-medium flex items-center gap-1 lg:gap-2 transition-all duration-200 shadow-md hover:shadow-lg hover:scale-105 active:scale-95">
                <svg class="w-3 h-3 lg:w-4 lg:h-4 group-hover:scale-110 transition-transform" fill="currentColor"
                    viewBox="0 0 20 20">
                    <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                    <path
                        d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                </svg>
                <span class="hidden sm:inline">Copy Room ID</span>
                <span class="sm:hidden">Copy</span>
            </button>
            <!-- Status indicator (desktop only) -->
            <div class="hidden lg:flex items-center gap-2 ml-3 pl-3 border-l border-gray-600 text-sm text-gray-400">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span>Connected</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col lg:grid lg:grid-cols-12 overflow-hidden lg:min-h-0">
        <!-- Sidebar Participantes -->
        <aside id="participants"
            class="fixed top-0 left-0 h-full w-64 bg-gray-800 border-r border-gray-700 transform -translate-x-full transition-transform duration-300 z-50 lg:relative lg:translate-x-0 lg:col-span-2 p-4 overflow-y-auto">
            <h2 class="text-lg font-semibold mb-4">Participants <span id="participant-count">0</span></h2>
            <ul id="participant-list" class="space-y-2 text-gray-300"></ul>
        </aside>

        <!-- Container VÃ­deo -->
        <section id="video-container"
            class="flex flex-col items-center justify-center bg-black relative flex-1 lg:col-span-7 p-4 overflow-hidden h-full lg:min-h-0">
            <div id="remote-videos" class="grid gap-4 w-full h-full place-items-center">
                <video id="local-video"
                    class="rounded-lg shadow-lg w-full h-full object-cover aspect-video border border-gray-700" autoplay
                    playsinline controls>
                </video>
            </div>
            <!-- Controls -->
            <div id="controls" class="flex gap-4 mt-6 bg-gray-800/80 backdrop-blur-md px-6 py-3 rounded-xl shadow-lg">
                <button id="mute-button" class="hover:scale-110 transition cursor-pointer active:scale-90">
                    <img src="/icons/microphone-off-outline.svg" alt="Mute" class="w-6 h-6 sm:w-12 sm:h-12">
                </button>
                <button id="video-button" class="hover:scale-110 transition cursor-pointer active:scale-90">
                    <img src="/icons/video-off-outline.svg" alt="Stop Video" class="w-6 h-6 sm:w-12 sm:h-12">
                </button>
                <button id="share-screen-button" class="hover:scale-110 transition cursor-pointer active:scale-90">
                    <img src="/icons/share-screen-off-outline.svg" alt="Share Screen" class="w-6 h-6 sm:w-12 sm:h-12">
                </button>
                <button id="leave-button" class="hover:scale-110 transition cursor-pointer active:scale-90">
                    <img src="/icons/exit-outline.svg" alt="Leave Room" class="w-6 h-6 sm:w-12 sm:h-12">
                </button>
            </div>
        </section>

        <!-- Chat -->
        <section id="chat-container"
            class="flex flex-col bg-gray-800 border-t border-gray-700 h-[45vh] max-h-[45vh] lg:h-full lg:max-h-full lg:min-h-0 lg:border-t-0 lg:border-l lg:col-span-3">
            <div id="messages" class="flex-1 min-h-0 overflow-y-auto p-4 space-y-3 whitespace-pre-wrap"></div>
            <div id="typing-indicator" class="hidden text-gray-400 mt-2 ml-2"></div>
            <div class="flex items-center gap-3 p-3 border-t border-gray-700 relative">
                <button id="emoji-toggle" class="p-2 hover:bg-gray-700 rounded-lg cursor-pointer">
                    <img src="/icons/emoji.svg" alt="Emoji" class="w-6 h-6">
                </button>
                <div id="emoji-picker"
                    class="hidden absolute bottom-14 left-0 z-50 w-64 sm:w-72 bg-gray-900 border border-gray-700 rounded-xl shadow-xl">
                    <div class="flex items-center justify-between px-3 py-2 border-b border-gray-700">
                        <span class="text-xs uppercase tracking-wide text-gray-400">Emojis</span>
                        <button id="emoji-close"
                            class="text-gray-400 hover:text-white text-xs px-2 py-1 rounded hover:bg-gray-700">
                            Close
                        </button>
                    </div>
                    <div class="p-2 max-h-60 overflow-y-auto">
                        <div class="grid grid-cols-8 gap-2 text-xl leading-none select-none">
                            {{#each emojis}}
                            <button class="hover:scale-110 transition cursor-pointer" data-emoji="{{this.char}}"
                                aria-label="{{this.label}}">{{this.char}}</button>
                            {{/each}}
                        </div>
                    </div>
                </div>
                <textarea id="message-input" placeholder="Type your message here..." maxlength="500" rows="1"
                    enterkeyhint="newline" autocomplete="off" autocapitalize="sentences" spellcheck="true"
                    class="flex-1 px-4 py-2 rounded-lg bg-gray-900 border border-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none resize-none max-h-40 overflow-y-auto"></textarea>
                <button id="send-button" class="p-2 hover:bg-gray-700 rounded-lg cursor-pointer">
                    <img src="/icons/send.svg" alt="Send" class="w-6 h-6">
                </button>
            </div>
        </section>
    </main>

    <input type="hidden" name="roomId" id="roomId" value="{{ roomId }}">
    <script src="/chat-bundle.js"></script>
</body>

</html>
