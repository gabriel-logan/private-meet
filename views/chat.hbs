<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="shortcut icon" href="favicon.svg" type="image/x-icon">
    <link rel="stylesheet" href="/styles.css">
    <script src="/socket.io/socket.io.js"></script>
</head>

<body class="h-screen flex flex-col bg-gray-900 text-white">
    <!-- Top Bar -->
    <header class="flex items-center justify-between p-4 bg-gray-800 border-b border-gray-700">
        <div class="flex items-center gap-3">
            <!-- Menu icon (mobile only) -->
            <img src="/icons/menu.svg" alt="Menu" id="menu-icon"
                class="w-7 h-7 cursor-pointer lg:hidden hover:scale-110 transition" />
            <h1 class="text-xl font-bold">Chat Room: {{ roomId }}</h1>
        </div>
        <input type="hidden" name="roomId" id="roomId" value="{{ roomId }}">
    </header>

    <main class="flex-1 grid grid-cols-1 lg:grid-cols-12 overflow-hidden">
        <!-- Sidebar Participantes -->
        <aside id="participants"
            class="fixed top-0 left-0 h-full w-64 bg-gray-800 border-r border-gray-700 transform -translate-x-full transition-transform duration-300 z-50 lg:relative lg:translate-x-0 lg:col-span-2 p-4 overflow-y-auto">
            <h2 class="text-lg font-semibold mb-4">Participants <span id="participant-count">0</span></h2>
            <ul id="participant-list" class="space-y-2 text-gray-300"></ul>
        </aside>

        <!-- Container VÃ­deo -->
        <section id="video-container"
            class="flex flex-col items-center justify-center bg-black relative lg:col-span-7 p-4 overflow-hidden h-full">
            <div id="remote-videos" class="grid gap-4 w-full h-full place-items-center">
                <video id="local-video" muted class="rounded-lg shadow-lg w-full h-full object-cover aspect-video"
                    src="/temp/a.mp4"></video>
                <video id="remote-video-1" class="rounded-lg shadow-lg w-full h-full object-cover aspect-video"
                    src="/temp/a.mp4"></video>
                <video id="remote-video-2" class="rounded-lg shadow-lg w-full h-full object-cover aspect-video"
                    src="/temp/a.mp4"></video>
                <video id="remote-video-3" class="rounded-lg shadow-lg w-full h-full object-cover aspect-video"
                    src="/temp/a.mp4"></video>
                <video id="remote-video-4" class="rounded-lg shadow-lg w-full h-full object-cover aspect-video"
                    src="/temp/a.mp4"></video>
                <video id="remote-video-5" class="rounded-lg shadow-lg w-full h-full object-cover aspect-video"
                    src="/temp/a.mp4"></video>
            </div>

            <!-- Controls -->
            <div id="controls" class="flex gap-4 mt-6 bg-gray-800/80 backdrop-blur-md px-6 py-3 rounded-xl shadow-lg">
                <button id="mute-button" class="hover:scale-110 transition cursor-pointer">
                    <img src="/icons/microphone-off-outline.svg" alt="Mute" class="w-6 h-6 sm:w-12 sm:h-12">
                </button>
                <button id="video-button" class="hover:scale-110 transition cursor-pointer">
                    <img src="/icons/video-off-outline.svg" alt="Stop Video" class="w-6 h-6 sm:w-12 sm:h-12">
                </button>
                <button id="share-screen-button" class="hover:scale-110 transition cursor-pointer">
                    <img src="/icons/share-screen-off-outline.svg" alt="Share Screen" class="w-6 h-6 sm:w-12 sm:h-12">
                </button>
                <button id="leave-button" class="hover:scale-110 transition cursor-pointer">
                    <img src="/icons/exit-outline.svg" alt="Leave Room" class="w-6 h-6 sm:w-12 sm:h-12">
                </button>
            </div>
        </section>

        <!-- Chat -->
        <section id="chat-container"
            class="flex flex-col bg-gray-800 border-t border-gray-700 lg:border-t-0 lg:border-l lg:col-span-3 h-full">
            <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-3 max-h-[calc(100vh-4rem-3rem)]">
                <!-- No messages yet -->
                <div class="text-center text-gray-400 mt-10">No messages yet. Start the conversation!</div>
            </div>
            <!-- Input -->
            <div class="flex items-center gap-3 p-3 border-t border-gray-700">
                <button class="p-2 hover:bg-gray-700 rounded-lg cursor-pointer">
                    <img src="/icons/emoji.svg" alt="Emoji" class="w-6 h-6">
                </button>
                <input type="text" id="message-input" placeholder="Type your message here..." maxlength="500"
                    class="flex-1 px-4 py-2 rounded-lg bg-gray-900 border border-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none">
                <button id="send-button" class="p-2 hover:bg-gray-700 rounded-lg cursor-pointer">
                    <img src="/icons/send.svg" alt="Send" class="w-6 h-6">
                </button>
            </div>
        </section>
    </main>

    <script>
        // Toggle sidebar (mobile)
        const menuIcon = document.getElementById("menu-icon");
        const participants = document.getElementById("participants");

        menuIcon.addEventListener("click", () => {
            participants.classList.toggle("-translate-x-full");
        });

        // When clicking outside the sidebar, close it (mobile)
        document.addEventListener("click", (event) => {
            if (!participants.contains(event.target) && !menuIcon.contains(event.target)) {
                participants.classList.add("-translate-x-full");
            }
        });

        function updateVideoGrid() {
            const container = document.getElementById('remote-videos');
            const videos = container.children.length;

            // Define colunas
            let cols = Math.ceil(Math.sqrt(videos));
            container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            // Ajusta a altura de cada linha
            let rows = Math.ceil(videos / cols);
            container.style.gridAutoRows = `calc(100% / ${rows} - 1rem)`;
        }

        updateVideoGrid();

        const messagesContainer = document.getElementById('messages');

        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        scrollToBottom();
    </script>

    <script src="/chat-bundle.js"></script>
</body>

</html>